scalar DateTime

type User {
  id: ID!
  email: String!
  avatarUrl: String
  createdAt: DateTime!
  workspaces: [Workspace!]!
}

type Workspace {
  id: ID!
  title: String!
  description: String
  icon: String
  pinned: Boolean!
  createdAt: DateTime!
  updatedAt: DateTime!
  owner: User!
  columns: [Column!]!
  cards: [Card!]!
  """Карточки воркспейса без колонки (backlog)."""
  backlog: [Card!]!
}

type Column {
  id: ID!
  title: String!
  order: Int!
  workspace: Workspace!
  cards: [Card!]!
}

enum CardType {
  NOTE
  LINK
  CHECKLIST
}

type Card {
  id: ID!
  createdAt: DateTime!
  updatedAt: DateTime!
  ownerId: ID!
  workspaceId: ID
  columnId: ID
  order: Int
  type: CardType!
  title: String
  done: Boolean!
  payload: String!
  tags: [String!]!
  owner: User!
  workspace: Workspace
  column: Column
}

type AuthPayload {
  user: User!
}

"""Публичная статистика пользователя (доступна любому авторизованному)."""
type UserStats {
  id: ID!
  avatarUrl: String
  """Всего выполненных карточек (done = true)."""
  totalCompletedCards: Int!
  """Воркспейсы пользователя с прогрессом (без доступа к контенту)."""
  workspaceStats: [WorkspaceStatsItem!]!
}

"""Воркспейс с агрегатами: выполнено / всего карточек."""
type WorkspaceStatsItem {
  id: ID!
  title: String!
  description: String
  icon: String
  totalCards: Int!
  completedCards: Int!
}

# Inputs

input CreateWorkspaceInput {
  title: String!
  description: String
  icon: String
}

input UpdateWorkspaceInput {
  title: String
  description: String
  icon: String
}

input CreateCardInput {
  type: CardType!
  title: String
  workspaceId: ID
  columnId: ID
  payload: String
  tags: [String!]
}

input UpdateCardInput {
  title: String
  done: Boolean
  columnId: ID
  order: Int
  payload: String
  tags: [String!]
}

input CardFilter {
  type: CardType
  done: Boolean
  workspaceId: ID
  columnId: ID
  search: String
}

# Queries

type Query {
  me: User
  workspace(id: ID!): Workspace
  myWorkspaces: [Workspace!]!
  """Все карточки пользователя (хаб: workspaceId = null, или по фильтру). sortOrder: createdAt_DESC (по умолчанию) | createdAt_ASC"""
  cards(filter: CardFilter, limit: Int, offset: Int, sortOrder: String): [Card!]!
  """Число карточек по фильтру (для пагинации)."""
  cardsCount(filter: CardFilter): Int!
  card(id: ID!): Card
  """Публичная статистика пользователя по id (любой авторизованный может запросить)."""
  userStats(userId: ID!): UserStats
}

# Mutations

type Mutation {
  # Auth
  signUp(email: String!, password: String!): AuthPayload!
  signIn(email: String!, password: String!): AuthPayload!
  signOut: Boolean!
  updateProfile(avatarUrl: String): User!

  # Workspace
  createWorkspace(input: CreateWorkspaceInput!): Workspace!
  updateWorkspace(id: ID!, input: UpdateWorkspaceInput!): Workspace!
  deleteWorkspace(id: ID!): Boolean!
  toggleWorkspacePinned(id: ID!): Workspace!

  # Column
  createColumn(workspaceId: ID!, title: String!): Column!
  updateColumn(id: ID!, title: String!): Column!
  deleteColumn(id: ID!): Boolean!
  reorderColumns(workspaceId: ID!, columnIds: [ID!]!): [Column!]!

  # Card
  createCard(input: CreateCardInput!): Card!
  updateCard(id: ID!, input: UpdateCardInput!): Card!
  deleteCard(id: ID!): Boolean!
  moveCard(id: ID!, columnId: ID, order: Int!): Card!
}
